--------------------------------------------
--------------------------------------------
Notas curso Pentesting - PLatzi
--------------------------------------------
--------------------------------------------

*** QUE ES PENTESTING? ***

acceso legal y autorizado a sistemas de informacion con el objetivo de hacerlos mas seguros,
con el objetivo de hacerlos mas seguros a traves de herramientas para la identificacion y
exploracion de vulnerabilidades

--> se recomienda tener una autorizacion por escrito
--> el acceso a sistemas de informacion sin autorizacion es un delito
--> analizar las fallas que puede tener y el objetivo es hacerlos mas seguros
--> hacking etico

Cuales son las fases que se realizan en un pentesting

1. Reconocimiento 

definir nuestros ojetivos
recolectar datos relevantes
identificar informacion claves sobre nuestro objetivos
aqui ya hay vulnerabilidades

2. Escaneo

escaneo para diferentes protocolos
identificacion de vulnerabilidades
analisis de potenciales riesgos

3. Explotacion

acceder a sistemas vulnerables
obtener privilegios
obtener informacion o accesos relevantes
tenemos que darle un valor agreado al cliente

4. Post Explotacion 

mantener o conservar el acceso o privilegios
generar nuevos accesos


Nota:

Se debe mapear para saber como se distribuyen los sistemas a auditar, y se realiza 
el proceso de las 4 fases donde se acordó el objetivo inicial junto con el cliente, 
posterior al primer proceso se continua al contiguo, a este se le llama Pivoting, 
que no necesariamente debe ser lineal, puede ser ramificado. En cada uno de estas 
partes del sistema se ejecutan las 4 fases de forma cíclica.

Conclusión:

Dar valor tangible al cliente es primoridial, es usar la mayor cantidad de información
legible, entendible y cuestionable para que el cliente se identifique con las 
vulnerabilidades de su sistema y opte por implementar medidas de seguridad o no.

Pruebas de penetración de un sistema informático que suceden en un ciclo de 4 etapas 
y que permiten dar información sobre vulnerabilidades y posteriores implementaciones 
de seguridad para dar valor.



*** MODELO DE TRABAJO PTES ***

modelo de ejecucion estandar de pruebas de penetracion o PEST
(penetration testing execution standar)

La estrucuta general del PTES define siete (7) secciones o pasos como la base para la
ejecucion de un proceso de pentesting

1. interaccion previa

define el alcance, tiempo y necesidades con el cliente, es importante tener en cuenta
factores y preguntas como

--> Horario en el que se harán las pruebas.
--> Cantidad de direcciones IP a probar.
--> Pruebas sobre equipos que deben estar disponibles.

2. Recoleccion de informacion

recopilar toda la informacion posible osbre los objetivos que seran probados durante el pestesting

3. modelo de amenazas

define cuales son los riesgos y las amenazas mas probables a las que esta exppuesto
y los bienes o activos que mas deberian proteger

4. anaisis de vulnerabilidad

identificar los posibles fallos de seguridad que peden ser aprovechados por un atacante

5. explotacion

ganar acceso a algun sistema o dispositivo aprovechando las fallas de seguridad encontradas en la fase anterior

6. post-explotacion

una vez ganado el acceso a un sistema, es posible que se requiera mantener este acceso
para continuar avanzando dentro del entorno para obtener informacion posteriormente o 
hacer actividades de monitoreo

7. reporte

se incluye como una fase de nuestro proceso, la etapa final de todo proceso de pentestig
debe ser la elaboracion de un reporte a partir de la informacion recolectad
--> se recomienda elaborar un mapa de riesgo con una escala de valor y generar un informe
ejecutivo que resuma los resultados obtenidos



*** INSTALACION Y CONFIGURACION DE MAQUINAS VIRTUALES PARA LABORATORIOS ***

Usaremos Kali Linux, una distribución especializada en seguridad informática, 
Metasploitable que es una distribución de linux con fallos de seguridad 
(creada intencionalmente para probar sistemas vulnerables) y usaremos una imagen de 
Windows 10. Además usaremos VirtualBox para cargar estos sistemas operativos.

Enlaces

https://www.kali.org/downloads/
https://sourceforge.net/projects/metasploitable/
https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/

La version de kali que se usa en el curso es esta:
64 bits: https://cdimage.kali.org/kali-2019.3/kali-linux-2019.3-amd64.iso



*** MODELO TCP/IP ***

Para ser un buen penester es primordial tener conocimientos de red

1. Aplicacion

protocolos correspondientes a cada una de las aplicaciones que usan recursos de red

2. transporte

mantenimiento de las conexiones y calidad de las conexiones y calidad en las transferecnias de datos

3. Internet

recursos para conexion entre nodos que no estan en el mismo segmento o seccion

4. Enlace

mecanismos fisicos de conexion y comunicacion


Encapsulado de datos

Aplicacion
--> agregando cierta partes de informacion a nuestro documento o data que estamos enviando
--> cuando se navega en nternet y se descarga, esa pagina se divide en pequeños bloques
con la informacion

Transporte
--> encabezado tcp (puertos)
    --> p1, p2 
    --> Payload --> (carga) lo que se esta transportando en la trama o segmenento
    es el que contiene el cuerpo de la informacion

Internet
--> encabezado ip
    --> IP1, IP2
        --> Payload
        
Enlace
--> encabezado Ethernet
    --> MAC1, mac2
        --> Payload


Nota
cuando hablemos de ataques estaremos hablando de Payload (pueede contener malware)
no cada vez que se hable de Payload estremos hablando de algo malo, es la informacion que esta
transportando la cabecera y la cola



*** ENRUTAMIENTO ***

1. Enlace de datos

se usan la ip y mac para identificar los dispositivos conectados


2. enrutamiento entre redes

cuando se conectan varios redes locales o segmentos de red, se necesitara instalar un
dispositivo adicional como un enrutador

lo que el enrutador sabe la direccion general que identifica la familia de los segmentos en red
no conoce en detalle las ips o macs que conforman los dispositivos conectados

cuando un dispositivo quiere comunicarse a otro segmento de red, el enrutador direcciona la peticion
se la pasa al swiche y este se encarga por medio de la ip en direccionar la peticion al punto destino


3. Tablas de enrutadores

conjunto de enrutadores conectando varios segmentos
los enrutadores no conocen en detalle las ips de los dispositivos conectados a internet
para eso estan las tablas, cada enrutador tendra una table de enrutadores donde almacena las ips de los
dispositivos conectados y validara la mejor ruta para entregar la peticion al dispositivo destino

rutas estaticas y dinamicas
--> manualmente
--> calculandose constantemente en el caso que un enlace falle o un erutador se apague



*** CONFIGURACION DE UNA MAQUINA VIRTUAL COMO ENRUTADOR ***

Link de descarga para la ISO tipo netinst de debian: 
https://cdimage.debian.org/debian-cd/current/i386/iso-cd/debian-10.4.0-i386-netinst.iso

crear el usuario: router1
asignar contraseña

nombre del usuario asigne: walther para este ejemplo

en la configuracion de los paquetes a instalar, quitar la opcion de desktop con la barra espaciadora
y asignar print server, ssh server y standar system ytilities

Nota
en el ultimo paso donde se solicita que el GRUB quede en el disco de arranque principal, indicar que si
y seleccionar la opcion de cargdor de arranque /dev/sda, de esta forma el Debian iniciara sin inconvenietes
una vez pida las credenciales del usuario root, se apaga la maquina y configura la red de la maquina virtual


se configura la red en 
--> red
    --> Adapter 1
        --> Internal Network
            --> name = Internal-10            
    
    --> Adapter 2
        --> Internal Network
            --> name = Internal-100
      
        
para validar las unidades de red configuradas mediante el siguiente comando
--> ls /sys/class/net

la configuracion de la red se realiza a travez del archivo mediante la sgte instruccion
--> nano /etc/network/interfaces

verificar las interfaces de red y configurar con la ip y mascara


Nota
con CTRL + C --> para salir, para guardar dar si
con CAT es para poder visualizar sin modifica
con nano es para modificar


(router1)
#the primary network interface
iface enp0s3
    address 192.168.10.254
    netmask 255.255.255.0
    
iface enp0s8
    address 192.168.100.1
    netmask 255.255.255.0
    
    
(router2)
#the primary network interface
iface enp0s3
    address 192.168.100.2
    netmask 255.255.255.0
    
iface enp0s8
    address 192.168.20.254
    netmask 255.255.255.0



** TABLAS DE ENRUTAMIENTO Y CONFIGURACION DE RUTAS ***
















