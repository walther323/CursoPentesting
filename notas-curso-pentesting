--------------------------------------------
--------------------------------------------
Notas curso Pentesting - Platzi
--------------------------------------------
--------------------------------------------

*** QUE ES PENTESTING? ***

acceso legal y autorizado a sistemas de informacion con el objetivo de hacerlos mas seguros,
con el objetivo de hacerlos mas seguros a traves de herramientas para la identificacion y
exploracion de vulnerabilidades

--> se recomienda tener una autorizacion por escrito
--> el acceso a sistemas de informacion sin autorizacion es un delito
--> analizar las fallas que puede tener y el objetivo es hacerlos mas seguros
--> hacking etico

Cuales son las fases que se realizan en un pentesting

1. Reconocimiento 

definir nuestros ojetivos
recolectar datos relevantes
identificar informacion claves sobre nuestro objetivos
aqui ya hay vulnerabilidades

2. Escaneo

escaneo para diferentes protocolos
identificacion de vulnerabilidades
analisis de potenciales riesgos

3. Explotacion

acceder a sistemas vulnerables
obtener privilegios
obtener informacion o accesos relevantes
tenemos que darle un valor agreado al cliente

4. Post Explotacion 

mantener o conservar el acceso o privilegios
generar nuevos accesos


Nota:

Se debe mapear para saber como se distribuyen los sistemas a auditar, y se realiza 
el proceso de las 4 fases donde se acordó el objetivo inicial junto con el cliente, 
posterior al primer proceso se continua al contiguo, a este se le llama Pivoting, 
que no necesariamente debe ser lineal, puede ser ramificado. En cada uno de estas 
partes del sistema se ejecutan las 4 fases de forma cíclica.

Conclusión:

Dar valor tangible al cliente es primoridial, es usar la mayor cantidad de información
legible, entendible y cuestionable para que el cliente se identifique con las 
vulnerabilidades de su sistema y opte por implementar medidas de seguridad o no.

Pruebas de penetración de un sistema informático que suceden en un ciclo de 4 etapas 
y que permiten dar información sobre vulnerabilidades y posteriores implementaciones 
de seguridad para dar valor.



*** MODELO DE TRABAJO PTES ***

modelo de ejecucion estandar de pruebas de penetracion o PEST
(penetration testing execution standar)

La estrucuta general del PTES define siete (7) secciones o pasos como la base para la
ejecucion de un proceso de pentesting

1. interaccion previa

define el alcance, tiempo y necesidades con el cliente, es importante tener en cuenta
factores y preguntas como

--> Horario en el que se harán las pruebas.
--> Cantidad de direcciones IP a probar.
--> Pruebas sobre equipos que deben estar disponibles.

2. Recoleccion de informacion

recopilar toda la informacion posible osbre los objetivos que seran probados durante el pestesting

3. modelo de amenazas

define cuales son los riesgos y las amenazas mas probables a las que esta exppuesto
y los bienes o activos que mas deberian proteger

4. anaisis de vulnerabilidad

identificar los posibles fallos de seguridad que peden ser aprovechados por un atacante

5. explotacion

ganar acceso a algun sistema o dispositivo aprovechando las fallas de seguridad encontradas en la fase anterior

6. post-explotacion

una vez ganado el acceso a un sistema, es posible que se requiera mantener este acceso
para continuar avanzando dentro del entorno para obtener informacion posteriormente o 
hacer actividades de monitoreo

7. reporte

se incluye como una fase de nuestro proceso, la etapa final de todo proceso de pentestig
debe ser la elaboracion de un reporte a partir de la informacion recolectad
--> se recomienda elaborar un mapa de riesgo con una escala de valor y generar un informe
ejecutivo que resuma los resultados obtenidos



*** INSTALACION Y CONFIGURACION DE MAQUINAS VIRTUALES PARA LABORATORIOS ***

Usaremos Kali Linux, una distribución especializada en seguridad informática, 
Metasploitable que es una distribución de linux con fallos de seguridad 
(creada intencionalmente para probar sistemas vulnerables) y usaremos una imagen de 
Windows 10. Además usaremos VirtualBox para cargar estos sistemas operativos.

Enlaces

https://www.kali.org/downloads/
https://sourceforge.net/projects/metasploitable/
https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/

La version de kali que se usa en el curso es esta:
64 bits: https://cdimage.kali.org/kali-2019.3/kali-linux-2019.3-amd64.iso



*** MODELO TCP/IP ***

Para ser un buen penester es primordial tener conocimientos de red

1. Aplicacion

protocolos correspondientes a cada una de las aplicaciones que usan recursos de red

2. transporte

mantenimiento de las conexiones y calidad de las conexiones y calidad en las transferecnias de datos

3. Internet

recursos para conexion entre nodos que no estan en el mismo segmento o seccion

4. Enlace

mecanismos fisicos de conexion y comunicacion


Encapsulado de datos

Aplicacion
--> agregando cierta partes de informacion a nuestro documento o data que estamos enviando
--> cuando se navega en nternet y se descarga, esa pagina se divide en pequeños bloques
con la informacion

Transporte
--> encabezado tcp (puertos)
    --> p1, p2 
    --> Payload --> (carga) lo que se esta transportando en la trama o segmenento
    es el que contiene el cuerpo de la informacion

Internet
--> encabezado ip
    --> IP1, IP2
        --> Payload
        
Enlace
--> encabezado Ethernet
    --> MAC1, mac2
        --> Payload


Nota
cuando hablemos de ataques estaremos hablando de Payload (pueede contener malware)
no cada vez que se hable de Payload estremos hablando de algo malo, es la informacion que esta
transportando la cabecera y la cola



*** ENRUTAMIENTO ***

1. Enlace de datos

se usan la ip y mac para identificar los dispositivos conectados


2. enrutamiento entre redes

cuando se conectan varios redes locales o segmentos de red, se necesitara instalar un
dispositivo adicional como un enrutador

lo que el enrutador sabe la direccion general que identifica la familia de los segmentos en red
no conoce en detalle las ips o macs que conforman los dispositivos conectados

cuando un dispositivo quiere comunicarse a otro segmento de red, el enrutador direcciona la peticion
se la pasa al swiche y este se encarga por medio de la ip en direccionar la peticion al punto destino


3. Tablas de enrutadores

conjunto de enrutadores conectando varios segmentos
los enrutadores no conocen en detalle las ips de los dispositivos conectados a internet
para eso estan las tablas, cada enrutador tendra una table de enrutadores donde almacena las ips de los
dispositivos conectados y validara la mejor ruta para entregar la peticion al dispositivo destino

rutas estaticas y dinamicas
--> manualmente
--> calculandose constantemente en el caso que un enlace falle o un erutador se apague



*** CONFIGURACION DE UNA MAQUINA VIRTUAL COMO ENRUTADOR ***

Link de descarga para la ISO tipo netinst de debian: 
https://cdimage.debian.org/debian-cd/current/i386/iso-cd/debian-10.4.0-i386-netinst.iso

crear el usuario: router1
asignar contraseña

nombre del usuario asigne: walther para este ejemplo

en la configuracion de los paquetes a instalar, quitar la opcion de desktop con la barra espaciadora
y asignar print server, ssh server y standar system ytilities

Nota
en el ultimo paso donde se solicita que el GRUB quede en el disco de arranque principal, indicar que si
y seleccionar la opcion de cargdor de arranque /dev/sda, de esta forma el Debian iniciara sin inconvenietes
una vez pida las credenciales del usuario root, se apaga la maquina y configura la red de la maquina virtual


se configura la red en 
--> red
    --> Adapter 1
        --> Internal Network
            --> name = Internal-10            
    
    --> Adapter 2
        --> Internal Network
            --> name = Internal-100
      
        
para validar las unidades de red configuradas mediante el siguiente comando
--> ls /sys/class/net

la configuracion de la red se realiza a travez del archivo mediante la sgte instruccion
--> nano /etc/network/interfaces

verificar las interfaces de red y configurar con la ip y mascara


Nota
con CTRL + C --> para salir, para guardar dar si
con CAT es para poder visualizar sin modifica
con nano es para modificar


(router1)
#the primary network interface
iface enp0s3
    address 192.168.10.254
    netmask 255.255.255.0
    
iface enp0s8
    address 192.168.100.1
    netmask 255.255.255.0
    
    
(router2)
#the primary network interface
iface enp0s3
    address 192.168.100.2
    netmask 255.255.255.0
    
iface enp0s8
    address 192.168.20.254
    netmask 255.255.255.0



** TABLAS DE ENRUTAMIENTO Y CONFIGURACION DE RUTAS ***


la maquina de KaliLinux se actualiza su confirguacion de de red y se le asigna la red interna 10
la maquina de metasploitables se actualiza su configuracion de red y se le asigna la red interna 20

comando para visualizar las rutas que tiene configurada la maquina
--> ip route show

para adicionar una nueva ruta el comando es
--> ip route add 192.168.20.0/24 via 192.168.100.2 dev enp0s8
 (se le configura la red 20/0 va a salir de la ip que conoce donde esta conectado el otro enrutador y por el dispositivo en mencion)

--> ip route add 192.168.10.0/24 via 192.168.100.1 dev enp0s3
 

Activar el enrutamiento

ingresar a los routers y esccribir el siguiente comando
--> (cat/nano) /proc/sys/net/ipv4/ip_forward
    editar el archivo y cambiar el valor de cero (0) por un uno (1) para ambos routers


Ahora procedemos a configurar la maquina metasploitable


ingresamos digtando el usuario y contraseña: msfadmin
--> elevamos privilegios usando: 
    --> sudo su    contraseña: msfadmin
    --> nano /etc/network/interfaces
    
se configura la red ingresando las siguientes ips
iface etho inet static
    address 192.168.20.34
    netmask 255.255.255.0
    network 192.168.20.0
    broadcast 192.168.20.255
    gateway 192.168.20.254
    
Nota
para que la maquina tome los cambios de red es necesario reiniciar el servicio, para eso usamos el siguiente comando
--> etc/init.d/networking restart



*** HTTRACK ***

es una herramienta que te permite copiar una pagina html y guardarla localmente
es usada para hacer fishing y engañar a los usuarios que estan hacediendo a la pagina real
para capturar las credenciales que el usuario digite

para la version que tenemos de kalilinux no esta instalada la libreria httrack
para eso ingresamos en la terminal el sgte comando
            
--> apt install httract

--> man httrack 
    apareceran todas las opciones de ayuda del modulo, para copiar una pagina usareos la instruccion 'O

--> httrack www.webscantest.com 'O copia/ --> (copia/ es un directorio donde alojaremos nuestro sitio)



**  WHOIS ***

1. Reconocimiento pasivo
Obtener información de fuentes públicas, donde no vamos a interactuar directamente con los servidores.

Reconocimiento pasivo = Open Source Intelligence OSINT

2. Reconocimiento activo
Cuando interactuamos directamente con nuestro objetivo.

Al iniciar es mejor empezar con el reconocimiento pasivo y con base en lo analizado decidimos si iniciamos la fase de reconocimiento activo.

Whois es una base de datos que contiene nombres de información de resolución DNS. El protocolo DNS asocia un nombre de dominio a una(s) dirección(es) IP.
    
    
Para tener en cuenta:
Con las nuevas disposiciones de la GDPR, muchos registradores de dominios al limitado los resultados WHOIS para cualquier tipo de búsqueda.

Actualmente casi todos los dominios que hay, estan enmascarados por la regulacion GPDR y no muestra mucho información relevante.
    
Tech Name: WhoisGuard Protected
http://www.whoisguard.com
si usan esto se protegen de dar informacion por whois


ejemplo de como usar el comando whois
--> whois platzi.com

visuaizara informacion de la pagina 



*** NETCRAFT ***

Netcraft es una compañía de seguridad informática que realiza auditorías y presta servicios de consultoría. 
Poseen una herramienta pública que permite analizar rápidamente servidores y subdominios para identificar qué versiones de sistemas están utilizando 
y así identificar vulnerabilidades.

con Whois obtenemos información publica sobre un dominio y con netcraft nos da mas información sobre el dominio

Hay sitios web que prestan el servicio de whois. Generalmente estos servicios en linea ofrecen mucha mas informacion que el propio comando de terminal. 
Solo escriban whois en el navegador y podran ver muchas opciones.
--> http://whois.domaintools.com/

Nota
Netcraft aplica cuando los subdominios están indexados en buscadores, si estos no están no los encuentra.
--> https://searchdns.netcraft.com/

Ahora pueden encontrar el scanner en:
--> https://sitereport.netcraft.com/



*** RECON-NG *** 

Recong-NG es una suite que se compone de varios módulos y que permite recolectar información a partir de dominios, direcciones IP y sitios web.

comando
--> recon-ng
--> show modules

Para la version 5.0 que viene en el kali 2019.3
    Para instalar modulos:
        --> marketplace install all
    Para usarlo
        --> modules load recon/domains-hosts/hackertarget
        ó
        --> modules load recon/domains-hosts/netcraft
    Para cargar el source
        --> options set SOURCE platzi.com
        --> run (ejecuta)

Para los que se bajaron la version nueva de Kali (2019.3) los comandos ya no son los mismos.
1- la aplicación viene sin módulos precargados.
2- los comandos cambiaron la sintaxis.

Marketplace search : Busqueda de modulos en repositorio
Marketplace install “modulo”: te instala el modulo
Modules search: busqueda de modulos locales.
Modules load “modulo”: carga el modulo
options list: Muesta la lista de opciones del modulo
options set : asigna alguna opcion
run: ejecuta el modulo.


identificar vulnerabilidades en fomrularios de sitios web relacionados con el login
--> modules load recon/domains-vulnerabilities/xssed
    
ejecutar el siguiente comando para analizar las vulnerabilidades
--> options set SOURCE platzi.com (pagina)
--> run (ejecuta)



*** ANALISIS DE PROTOCOLOS TCP/UDP ***

Protocolos de transporte

1. UDP (User Datagram Protocol) no está orientado a la conexión, solo está enviando información constantemente.
    Es decir es un protocolo que no va mantener o no se preocupa por mantener una regularidad en la conexion
    
2. TCP (Transmission Control Protocol) está orientado a la conexión, busca mantener la conexión estable y que no se pierda la información durante el intercambio.

aportes de estudiantes del tema

UDP --> (streaming) se usa en servicios de streaming para transmisionn de video y voz.
    Video, VOIP, Camaras. Es mas rápido, no necesita confirmación.

TCP --> (descarga) garantiza la conectividad de un punto a otro, por medio del saludo de tres vias
    Usado por Web, mail, Bases de Datos, entre otros. Necesita ir y venir por confirmación.
     
SYN SYN+ACK ACK y finaliza la comunicación con FIN ACK FIN ACK

Puertos mas comunes
de los 65535 puertos disponibles entre los mas conocidos tenemos
--> el numero 0 esta reservado y no se utiliza, su funcion es identificar los diferentes servicios que estan disponibles atra vez de una interfaz de red.
--> 20 TRANSFERENCIA FTP
--> 21 FTP
--> 22 SSH
--> 23 TELNET
--> 25 SMTP
--> 53 DNS
--> 80 HTTP
--> 137-139 BIOS
--> 443 HTTPS
--> 445 SMB
--> 1433 MSSQL
--> 3306 MYSQL
--> 3389 RDP
--> 5800 VNC SOBRE HTTP
--> 5900 VNC

para informacion en detalle esta el siguiente enlace para consulta
    --> shorturl.at/eqGN8













